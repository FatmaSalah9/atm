"use strict";(self.webpackChunkatm_mangment=self.webpackChunkatm_mangment||[]).push([[900],{7900:(F,u,s)=>{s.r(u),s.d(u,{OwnerReportComponent:()=>W});var O=s(6707),e=s(5879),m=s(6814),A=s(7361),D=s(882),E=s(3740),h=s(8431),_=s(6223),x=s(1097),f=s(527),b=s(7285),C=s(4456),M=s.n(C),v=s(9846),Z=s(7394),R=s(4716),T=s(3999),L=s(8575);const w=["excelTable"];function I(a,c){if(1&a){const t=e.EpF();e.TgZ(0,"tr")(1,"td",26),e._uU(2),e.qZA(),e.TgZ(3,"td",26),e._uU(4),e.ALo(5,"date"),e.qZA(),e.TgZ(6,"td",26),e._uU(7),e.qZA(),e.TgZ(8,"td",26),e._uU(9),e.qZA(),e.TgZ(10,"td",26),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"td",26),e._uU(14),e.qZA(),e.TgZ(15,"td",26)(16,"i",28),e.NdJ("click",function(){const l=e.CHM(t).$implicit,i=e.oxw(3);return e.KtG(i.openImagesPrivew(l))}),e.qZA()()()}if(2&a){const t=c.$implicit,n=c.index;e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(e.xi3(5,6,t.detailsDate,"yyyy/MM/dd hh:mm:ss")),e.xp6(3),e.Oqu(t.orderStatusName),e.xp6(2),e.Oqu(t.atmCode),e.xp6(2),e.Oqu(t.damagesComment?t.damagesComment:e.lcZ(12,9,"reports.bank.NO_COMMENT")),e.xp6(3),e.Oqu(t.userName)}}function P(a,c){if(1&a&&(e.TgZ(0,"div",21)(1,"table",22,23)(3,"thead",24)(4,"tr",25)(5,"th",26),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"th",26),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"th",26),e._uU(12),e.ALo(13,"translate"),e.qZA(),e.TgZ(14,"th",26),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.TgZ(17,"th",26),e._uU(18),e.ALo(19,"translate"),e.qZA(),e.TgZ(20,"th",26),e._uU(21),e.ALo(22,"translate"),e.qZA(),e.TgZ(23,"th",26),e._uU(24),e.ALo(25,"translate"),e.qZA()()(),e.TgZ(26,"tbody"),e.YNc(27,I,17,11,"tr",27),e.qZA()()()),2&a){const t=e.oxw(2);e.xp6(6),e.Oqu(e.lcZ(7,8,"reports.bank.NUMBER")),e.xp6(3),e.Oqu(e.lcZ(10,10,"reports.bank.DETAILS_DATE")),e.xp6(3),e.Oqu(e.lcZ(13,12,"reports.bank.STATUS")),e.xp6(3),e.Oqu(e.lcZ(16,14,"reports.bank.ATM_CODE")),e.xp6(3),e.Oqu(e.lcZ(19,16,"reports.bank.DAMAGES_COMMENT")),e.xp6(3),e.Oqu(e.lcZ(22,18,"reports.bank.USERNAME")),e.xp6(3),e.Oqu(e.lcZ(25,20,"reports.bank.IMAGE")),e.xp6(3),e.Q6J("ngForOf",t.filteredData.length>0?t.filteredData:t.dataTable)}}function k(a,c){if(1&a&&(e.TgZ(0,"div",19),e.YNc(1,P,28,22,"div",20),e.qZA()),2&a){const t=e.oxw(),n=e.MAs(40);e.xp6(1),e.Q6J("ngIf",t.dataTable.length>0)("ngIfElse",n)}}function U(a,c){1&a&&(e.TgZ(0,"p",30),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&a&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"reports.bank.NO_DATA_FOUND")," "))}function y(a,c){if(1&a&&e.YNc(0,U,3,3,"p",29),2&a){const t=e.oxw();e.Q6J("ngIf",t.isLoadData)}}function N(a,c){1&a&&(e.TgZ(0,"div",31),e._UZ(1,"div",32),e.qZA())}let W=(()=>{class a{ngOnInit(){this.getGovernoraties()}constructor(t){this.governmentService=t,this.filteredData=[],this.searchQuery="",this.userData=null,this.isLoadData=!0,this.workPlaneReport=new O.LF,this.ngbModal=(0,e.f3M)(b.FF),this.citiesList=[],this.governoratiesList=[],this.lookupService=(0,e.f3M)(A.W),this.userService=(0,e.f3M)(D.K),this.reportsService=(0,e.f3M)(x.F),this.dataTable=[],this.subscription=new Z.w0,this.userService.getUserData().subscribe(n=>{this.userData=n})}getGovernoraties(){this.subscription.add(this.governmentService.getGovernoraties().subscribe(t=>{this.governoratiesList=t}))}getCities(t){this.subscription.add(this.governmentService.getCitiesByGovernorateId(t).subscribe(n=>{this.citiesList=n}))}onGovernorateChange(t){this.workPlaneReport.governorateCodeId=t=this.governorateId,this.getReport(),t?this.getCities(t):this.citiesList=[]}onCityChange(t){this.workPlaneReport.cityCodeId=this.cityId,this.getReport()}getReport(){this.isLoadData=!1,this.workPlaneReport.bankDataId=this.userData.BankId,this.reportsService.getWorkPlanesReport(this.workPlaneReport).pipe((0,R.x)(()=>this.isLoadData=!0)).subscribe(t=>{t&&(this.dataTable=t.filter(n=>5==n.orderStatusId&&n.userName))},t=>{console.error("Error fetching report:",t)})}openImage(t){window.open(t,"_blank")}openImages(t){let n=this.ngbModal.open(f.I,{backdrop:"static"});n.componentInstance.images=t,n.result.then(r=>{r&&this.getReport()})}exportAsExcel(){const o={worksheet:"Worksheet",table:this.excelTable.nativeElement.innerHTML},d=document.createElement("a");var g,p;d.download="file.xls",d.href="data:application/vnd.ms-excel;charset=utf-8;base64,"+(g=o,p='\n      <html xmlns:o="urn:schemas-microsoft-com:office:office"\n            xmlns:x="urn:schemas-microsoft-com:office:excel"\n            xmlns="http://www.w3.org/TR/REC-html40">\n        <head>\n          <meta charset="UTF-8">\n          \x3c!--[if gte mso 9]>\n          <xml>\n            <x:ExcelWorkbook>\n              <x:ExcelWorksheets>\n                <x:ExcelWorksheet>\n                  <x:Name>{worksheet}</x:Name>\n                  <x:WorksheetOptions>\n                    <x:DisplayGridlines/>\n                  </x:WorksheetOptions>\n                </x:ExcelWorksheet>\n              </x:ExcelWorksheets>\n            </x:ExcelWorkbook>\n          </xml>\n          <![endif]--\x3e\n        </head>\n        <body>\n          <table>{table}</table>\n        </body>\n      </html>'.replace(/{(\w+)}/g,(S,q)=>g[q]),window.btoa(unescape(encodeURIComponent(p)))),d.click()}openImagesPrivew(t){let n=this.ngbModal.open(f.I,{size:"lg",backdrop:"static"});n.componentInstance.headerId=t.workPlanHeaderIdId,n.componentInstance.footerId=t.footerId,n.result.then(r=>{r&&this.getReport()})}changeDateFrom(t){this.workPlaneReport.dateFrom=t,this.getReport()}changeDateTo(t){this.workPlaneReport.dateTo=t,this.getReport()}exportToPDF(){const t=document.getElementById("pdf-export");t?M()(t,{scale:2}).then(n=>{const i=208*n.height/n.width;let o=i;const d=n.toDataURL("image/png");let p=new v.default("p","mm","a4"),g=0;for(p.addImage(d,"PNG",0,g,208,i),o-=295;o>0;)g=o-i,p.addPage(),p.addImage(d,"PNG",0,g,208,i),o-=295;p.save("bank.pdf")}).catch(n=>{console.error("PDF export failed: ",n)}):console.error("Element with ID 'pdf-export' not found.")}filterData(){this.searchQuery?(this.filteredData=this.dataTable.filter(t=>t.atmCode.toLowerCase().includes(this.searchQuery.toLowerCase())),console.log(this.filteredData)):this.filteredData=this.dataTable}static#e=this.\u0275fac=function(n){return new(n||a)(e.Y36(L.k))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["app-owner-report"]],viewQuery:function(n,r){if(1&n&&e.Gf(w,5),2&n){let l;e.iGM(l=e.CRH())&&(r.excelTable=l.first)}},standalone:!0,features:[e.jDz],decls:43,vars:51,consts:[[3,"ngSubmit"],["ownerReportForm","ngForm"],[1,"row_first"],[3,"required","label","currentForm","ngbDateStruct","CurentDate"],["for","governorate",1,"required","my-1"],["bindLabel","governorateNameL1","bindValue","governorateId",3,"clearable","name","ngModel","items","searchable","required","notFoundText","ngModelChange","change"],["for","city",1,"required","my-1"],["bindLabel","cityNameL1","bindValue","cityId",3,"clearable","name","ngModel","items","searchable","required","notFoundText","ngModelChange","change"],["type","submit",1,"btn","btn-dark","shadow-lg"],[1,"row_search"],["type","text",1,"form-control",3,"placeholder","ngModel","ngModelChange"],[1,"d-flex","gap-3"],[1,"btn","btn-dark",3,"click"],[1,"fa","fa-file-excel"],[1,"btn","btn-dark","ms-2",3,"click"],[1,"fa-solid","fa-file-pdf"],["class","row",4,"ngIf","ngIfElse"],["noData",""],["spinner",""],[1,"row"],["class","col-12 pt-2",4,"ngIf","ngIfElse"],[1,"col-12","pt-2"],["id","pdf-export",1,"table","table-responsive","table-striped"],["excelTable",""],[1,"bg-light","sticky-top","top-0","table-dark"],[1,"bg-dark"],[1,"text-center"],[4,"ngFor","ngForOf"],[1,"fa-solid","fa-images","pointer",3,"click"],["class","text-warning fs-2 w-100 text-center mt-5",4,"ngIf"],[1,"text-warning","fs-2","w-100","text-center","mt-5"],[1,"w-100","text-center","mt-5"],[1,"spinner-border","text-warning",2,"width","60px","height","60px"]],template:function(n,r){if(1&n){const l=e.EpF();e.TgZ(0,"form",0,1),e.NdJ("ngSubmit",function(){e.CHM(l);const o=e.MAs(1);return e.KtG(o.valid&&r.getReport())}),e.TgZ(2,"div",2)(3,"div")(4,"app-date-input",3),e.NdJ("CurentDate",function(o){return r.changeDateFrom(o)}),e.ALo(5,"translate"),e.qZA()(),e.TgZ(6,"div")(7,"app-date-input",3),e.NdJ("CurentDate",function(o){return r.changeDateTo(o)}),e.ALo(8,"translate"),e.qZA()(),e.TgZ(9,"div")(10,"label",4),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"ng-select",5),e.NdJ("ngModelChange",function(o){return r.governorateId=o})("change",function(o){return r.onGovernorateChange(o)}),e.ALo(14,"translate"),e.qZA()(),e.TgZ(15,"div")(16,"label",6),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.TgZ(19,"ng-select",7),e.NdJ("ngModelChange",function(o){return r.cityId=o})("change",function(o){return r.onCityChange(o)}),e.ALo(20,"translate"),e.qZA()(),e.TgZ(21,"div")(22,"button",8),e._uU(23),e.ALo(24,"translate"),e.qZA()()()(),e.TgZ(25,"div",9)(26,"div")(27,"input",10),e.NdJ("ngModelChange",function(o){return r.searchQuery=o})("ngModelChange",function(){return r.filterData()}),e.ALo(28,"translate"),e.qZA()(),e.TgZ(29,"div",11)(30,"button",12),e.NdJ("click",function(){return r.exportAsExcel()}),e._uU(31),e.ALo(32,"translate"),e._UZ(33,"i",13),e.qZA(),e.TgZ(34,"button",14),e.NdJ("click",function(){return r.exportToPDF()}),e._uU(35),e.ALo(36,"translate"),e._UZ(37,"i",15),e.qZA()()(),e.YNc(38,k,2,2,"div",16),e.YNc(39,y,1,1,"ng-template",null,17,e.W1O),e.YNc(41,N,2,0,"ng-template",null,18,e.W1O)}if(2&n){const l=e.MAs(1),i=e.MAs(42);e.xp6(4),e.Q6J("required",!0)("label",e.lcZ(5,31,"reports.bank.FROM_DATE"))("currentForm",l)("ngbDateStruct",r.workPlaneReport.startDateMdule),e.xp6(3),e.Q6J("required",!0)("label",e.lcZ(8,33,"reports.bank.TO_DATE"))("currentForm",l)("ngbDateStruct",r.workPlaneReport.endDateMdule),e.xp6(4),e.Oqu(e.lcZ(12,35,"reports.bank.GOVERNORATE")),e.xp6(2),e.Q6J("clearable",!0)("name","governorate")("ngModel",r.governorateId)("items",r.governoratiesList)("searchable",!0)("required",!0)("notFoundText",e.lcZ(14,37,"reports.bank.NO_DATA_FOUND")),e.xp6(4),e.Oqu(e.lcZ(18,39,"reports.bank.CITY")),e.xp6(2),e.Q6J("clearable",!0)("name","city")("ngModel",r.cityId)("items",r.citiesList)("searchable",!0)("required",!0)("notFoundText",e.lcZ(20,41,"reports.bank.NO_DATA_FOUND")),e.xp6(4),e.hij(" ",e.lcZ(24,43,"reports.bank.SHOW_DATA")," "),e.xp6(4),e.s9C("placeholder",e.lcZ(28,45,"reports.workplans.SEARCH_PLACEHOLDER")),e.Q6J("ngModel",r.searchQuery),e.xp6(4),e.hij(" ",e.lcZ(32,47,"reports.bank.EXPORT_XLSX")," "),e.xp6(4),e.hij(" ",e.lcZ(36,49,"reports.bank.EXPORT_PDF")," "),e.xp6(3),e.Q6J("ngIf",r.isLoadData)("ngIfElse",i)}},dependencies:[m.ez,m.sg,m.O5,m.uU,E.Y,h.A0,h.w9,_.u5,_._Y,_.Fj,_.JJ,_.JL,_.Q7,_.On,_.F,T.aw,T.X$],styles:[".row_first[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:20px;align-items:flex-end}.row_search[_ngcontent-%COMP%]{margin-top:20px;display:grid;grid-template-columns:repeat(auto-fill,minmax(400px,1fr));gap:20px;align-items:center}"]})}return a})()}}]);