"use strict";(self.webpackChunkatm_mangment=self.webpackChunkatm_mangment||[]).push([[101],{9101:(J,h,r)=>{r.r(h),r.d(h,{WorkPlansReportComponent:()=>q});var t=r(5879),m=r(6814),T=r(6707),c=r(6223),f=r(8431),A=r(3740),x=r(1849),E=r(5277),D=r(882),C=r(1097),M=r(7285),Z=r(527),b=r(9315),P=r(9846),u=(r(3403),r(3999)),R=r(4456),k=r.n(R);const L=["excelTable"];function v(o,_){if(1&o){const e=t.EpF();t.TgZ(0,"ng-select",22,23),t.NdJ("ngModelChange",function(n){t.CHM(e);const s=t.oxw();return t.KtG(s.workPlaneReport.representativeId=n)})("change",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.getReport())}),t.ALo(2,"translate"),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("clearable",!0)("name","city")("items",e.representativiesList)("ngModel",e.workPlaneReport.representativeId)("notFoundText",t.lcZ(2,6,"reports.workplans.NO_DATA_FOUND"))("searchable",!0)}}function I(o,_){if(1&o){const e=t.EpF();t.TgZ(0,"ng-select",24,25),t.NdJ("ngModelChange",function(n){t.CHM(e);const s=t.oxw();return t.KtG(s.workPlaneReport.orderStatusId=n)})("change",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.getReport())}),t.ALo(2,"translate"),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("clearable",!0)("name","OrderStatus")("items",e.orderStatusList)("ngModel",e.workPlaneReport.orderStatusId)("notFoundText",t.lcZ(2,6,"reports.workplans.NO_DATA_FOUND"))("searchable",!0)}}function W(o,_){if(1&o){const e=t.EpF();t.TgZ(0,"button",26),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.exportAsExcel())}),t._uU(1),t.ALo(2,"translate"),t._UZ(3,"i",27),t.qZA()}2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"reports.workplans.EXPORT_XLSX")," "))}function U(o,_){if(1&o){const e=t.EpF();t.TgZ(0,"button",28),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.exportToPDF())}),t._uU(1),t.ALo(2,"translate"),t._UZ(3,"i",29),t.qZA()}2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"reports.workplans.EXPORT_PDF")," "))}function w(o,_){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t._UZ(2,"br"),t.qZA()),2&o){const e=_.$implicit;t.xp6(1),t.hij(" ",e.comment," ")}}function S(o,_){if(1&o&&(t.ynx(0),t.YNc(1,w,3,1,"span",20),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngForOf",e.damagesComments)}}function y(o,_){1&o&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"reports.workplans.NO_COMMENT")))}function F(o,_){if(1&o){const e=t.EpF();t.TgZ(0,"tr")(1,"td",19),t._uU(2),t.qZA(),t.TgZ(3,"td",19),t._uU(4),t.ALo(5,"date"),t.qZA(),t.TgZ(6,"td",19),t._uU(7),t.ALo(8,"date"),t.qZA(),t.TgZ(9,"td",19),t._uU(10),t.ALo(11,"date"),t.qZA(),t.TgZ(12,"td",19),t._uU(13),t.qZA(),t.TgZ(14,"td",19),t._uU(15),t.qZA(),t.TgZ(16,"td",19),t.YNc(17,S,2,1,"ng-container",30),t.YNc(18,y,3,3,"ng-template",null,31,t.W1O),t.qZA(),t.TgZ(20,"td",19),t._uU(21),t.qZA(),t.TgZ(22,"td",19)(23,"i",32),t.NdJ("click",function(){const s=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.openImages(s))}),t.qZA()()()}if(2&o){const e=_.$implicit,a=_.index,n=t.MAs(19);t.xp6(2),t.Oqu(a+1),t.xp6(2),t.Oqu(t.xi3(5,9,e.startDate,"yyyy/MM/dd")),t.xp6(3),t.Oqu(t.xi3(8,12,e.endDate,"yyyy/MM/dd")),t.xp6(3),t.Oqu(t.xi3(11,15,e.detailsDate,"yyyy/MM/dd hh:mm:ss")),t.xp6(3),t.Oqu(e.orderStatusName),t.xp6(2),t.Oqu(e.atmCode),t.xp6(2),t.Q6J("ngIf",e.damagesComments&&e.damagesComments.length>0)("ngIfElse",n),t.xp6(4),t.Oqu(e.userName)}}function N(o,_){1&o&&(t.TgZ(0,"h3",19),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"reports.workplans.NO_DATA_FOUND")))}let q=(()=>{class o{constructor(){this.dataTable=[],this.filteredData=[],this.searchQuery="",this.workPlaneReport=new T.YJ,this.representativiesList=[],this.orderStatusList=[],this.workPlaneService=(0,t.f3M)(x.B),this.companyService=(0,t.f3M)(E.J),this.reportsService=(0,t.f3M)(C.F),this.userService=(0,t.f3M)(D.K),this.ngbModal=(0,t.f3M)(M.FF),this.translate=(0,t.f3M)(u.sK),this.userService.getUserData().subscribe(e=>{this.userData=e})}ngOnInit(){this.getOrderStatus(),this.getAllRepresentativesForSpeceificCompany(),this.getReport()}getReport(){this.dataTable=[],this.reportsService.getWorkPlanesReport(this.workPlaneReport).subscribe(e=>{const a=e.map(n=>this.reportsService.getComments(n.footerId));(0,b.D)(a).subscribe(n=>{this.dataTable=e.map((s,l)=>({...s,damagesComments:n[l]})),this.filteredData=this.dataTable})})}filterData(){this.searchQuery?(this.filteredData=this.dataTable.filter(e=>e.atmCode.toLowerCase().includes(this.searchQuery.toLowerCase())),console.log(this.filteredData)):this.filteredData=this.dataTable}changeFromDate(e){this.workPlaneReport.dateFrom=e,this.getReport()}changeToDate(e){this.workPlaneReport.dateTo=e,this.getReport()}exportAsExcel(){const i={worksheet:"Worksheet",table:this.excelTable.nativeElement.innerHTML},d=document.createElement("a");var g,p;d.download="file.xls",d.href="data:application/vnd.ms-excel;base64,"+(g=i,p='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head>\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e</head><body><table>{table}</table></body></html>'.replace(/{(\w+)}/g,function(Q,K){return g[K]}),window.btoa(unescape(encodeURIComponent(p)))),d.click()}getOrderStatus(){this.workPlaneService.getAllOrderStatus().subscribe(e=>{e&&(this.orderStatusList=e)})}getAllRepresentativesForSpeceificCompany(){this.companyService.getAllRepresentativesForSpeceificCompany(this.userData?this.userData.CompanyId:"").subscribe(e=>{e&&(this.representativiesList=e)})}openImage(e){window.open(e,"_blank")}openImages(e){let a=this.ngbModal.open(Z.I,{backdrop:"static"});a.componentInstance.headerId=e.workPlanHeaderIdId,a.componentInstance.footerId=e.footerId,a.result.then(n=>{n&&this.getReport()})}exportToPDF(){const e=document.getElementById("pdf-export");e?k()(e,{scale:2}).then(a=>{const l=208*a.height/a.width;let i=l;const d=a.toDataURL("image/png");let p=new P.default("p","mm","a4"),g=0;for(p.addImage(d,"PNG",0,g,208,l),i-=295;i>0;)g=i-l,p.addPage(),p.addImage(d,"PNG",0,g,208,l),i-=295;p.save("work plan.pdf")}).catch(a=>{console.error("PDF export failed: ",a)}):console.error("Element with ID 'pdf-export' not found.")}static#t=this.\u0275fac=function(a){return new(a||o)};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-work-plans-report"]],viewQuery:function(a,n){if(1&a&&t.Gf(L,5),2&a){let s;t.iGM(s=t.CRH())&&(n.excelTable=s.first)}},standalone:!0,features:[t.jDz],decls:64,vars:50,consts:[[1,"p-3",3,"ngSubmit"],["workPlaneForm","ngForm"],[1,"row"],[1,"col-md-3"],[3,"label","currentForm","ngbDateStruct","CurentDate"],["for","city",1,"my-1"],["ngDefaultControl","","bindLabel","userName","bindValue","id",3,"clearable","name","items","ngModel","notFoundText","searchable","ngModelChange","change",4,"ngIf"],["for","OrderStatus",1,"my-1"],["ngDefaultControl","","bindLabel","statusNameL2","bindValue","statusId",3,"clearable","name","items","ngModel","notFoundText","searchable","ngModelChange","change",4,"ngIf"],[1,"col-md-6"],[1,"row","justify-content-center"],[1,"col-6"],["type","text",1,"form-control","mb-3",3,"placeholder","ngModel","ngModelChange"],["class","btn btn-dark",3,"click",4,"ngIf"],["class","btn btn-dark ms-2",3,"click",4,"ngIf"],["id","pdf-export",1,"table","table-responsive","table-striped"],["excelTable",""],[1,"bg-light","sticky-top","top-0","table-dark"],[1,"bg-dark"],[1,"text-center"],[4,"ngFor","ngForOf"],["class","text-center",4,"ngIf"],["ngDefaultControl","","bindLabel","userName","bindValue","id",3,"clearable","name","items","ngModel","notFoundText","searchable","ngModelChange","change"],["representative","ngModel"],["ngDefaultControl","","bindLabel","statusNameL2","bindValue","statusId",3,"clearable","name","items","ngModel","notFoundText","searchable","ngModelChange","change"],["orderStatus","ngModel"],[1,"btn","btn-dark",3,"click"],[1,"fa","fa-file-excel"],[1,"btn","btn-dark","ms-2",3,"click"],[1,"fa-solid","fa-file-pdf"],[4,"ngIf","ngIfElse"],["elseTemplate",""],[1,"fa-solid","fa-images","pointer",3,"click"]],template:function(a,n){if(1&a){const s=t.EpF();t.TgZ(0,"form",0,1),t.NdJ("ngSubmit",function(){t.CHM(s);const i=t.MAs(1);return t.KtG(i.valid&&n.getReport())}),t.TgZ(2,"div",2)(3,"div",3)(4,"app-date-input",4),t.NdJ("CurentDate",function(i){return n.changeFromDate(i)}),t.ALo(5,"translate"),t.qZA()(),t.TgZ(6,"div",3)(7,"app-date-input",4),t.NdJ("CurentDate",function(i){return n.changeToDate(i)}),t.ALo(8,"translate"),t.qZA()(),t.TgZ(9,"div",3)(10,"div")(11,"label",5),t._uU(12),t.ALo(13,"translate"),t.qZA(),t.YNc(14,v,3,8,"ng-select",6),t.qZA()(),t.TgZ(15,"div",3)(16,"div")(17,"label",7),t._uU(18),t.ALo(19,"translate"),t.qZA(),t.YNc(20,I,3,8,"ng-select",8),t.qZA()()()(),t.TgZ(21,"div",2)(22,"div",9)(23,"div",10)(24,"div",11)(25,"input",12),t.NdJ("ngModelChange",function(i){return n.searchQuery=i})("ngModelChange",function(){return n.filterData()}),t.ALo(26,"translate"),t.qZA()()()(),t.TgZ(27,"div",9),t.YNc(28,W,4,3,"button",13),t.YNc(29,U,4,3,"button",14),t.qZA()(),t.TgZ(30,"div",2)(31,"table",15,16)(33,"thead",17)(34,"tr",18)(35,"th",19),t._uU(36,"#"),t.qZA(),t.TgZ(37,"th",19),t._uU(38),t.ALo(39,"translate"),t.qZA(),t.TgZ(40,"th",19),t._uU(41),t.ALo(42,"translate"),t.qZA(),t.TgZ(43,"th",19),t._uU(44),t.ALo(45,"translate"),t.qZA(),t.TgZ(46,"th",19),t._uU(47),t.ALo(48,"translate"),t.qZA(),t.TgZ(49,"th",19),t._uU(50),t.ALo(51,"translate"),t.qZA(),t.TgZ(52,"th",19),t._uU(53),t.ALo(54,"translate"),t.qZA(),t.TgZ(55,"th",19),t._uU(56),t.ALo(57,"translate"),t.qZA(),t.TgZ(58,"th",19),t._uU(59),t.ALo(60,"translate"),t.qZA()()(),t.TgZ(61,"tbody"),t.YNc(62,F,24,18,"tr",20),t.qZA()(),t.YNc(63,N,3,3,"h3",21),t.qZA()}if(2&a){const s=t.MAs(1);t.xp6(4),t.Q6J("label",t.lcZ(5,24,"reports.workplans.FROM_DATE"))("currentForm",s)("ngbDateStruct",n.workPlaneReport.startDateMdule),t.xp6(3),t.Q6J("label",t.lcZ(8,26,"reports.workplans.TO_DATE"))("currentForm",s)("ngbDateStruct",n.workPlaneReport.endDateMdule),t.xp6(5),t.Oqu(t.lcZ(13,28,"reports.workplans.REPRESENTATIVE")),t.xp6(2),t.Q6J("ngIf",n.representativiesList),t.xp6(4),t.Oqu(t.lcZ(19,30,"reports.workplans.ORDER_STATUS")),t.xp6(2),t.Q6J("ngIf",n.orderStatusList),t.xp6(5),t.s9C("placeholder",t.lcZ(26,32,"reports.workplans.SEARCH_PLACEHOLDER")),t.Q6J("ngModel",n.searchQuery),t.xp6(3),t.Q6J("ngIf",n.filteredData.length>0),t.xp6(1),t.Q6J("ngIf",n.filteredData.length>0),t.xp6(9),t.Oqu(t.lcZ(39,34,"reports.workplans.START_DATE")),t.xp6(3),t.Oqu(t.lcZ(42,36,"reports.workplans.END_DATE")),t.xp6(3),t.Oqu(t.lcZ(45,38,"reports.workplans.DETAILS_DATE")),t.xp6(3),t.Oqu(t.lcZ(48,40,"reports.workplans.STATUS")),t.xp6(3),t.Oqu(t.lcZ(51,42,"reports.workplans.ATM_CODE")),t.xp6(3),t.Oqu(t.lcZ(54,44,"reports.workplans.DAMAGES_COMMENT")),t.xp6(3),t.Oqu(t.lcZ(57,46,"reports.workplans.USERNAME")),t.xp6(3),t.Oqu(t.lcZ(60,48,"reports.workplans.IMAGE")),t.xp6(3),t.Q6J("ngForOf",n.filteredData),t.xp6(1),t.Q6J("ngIf",0==n.filteredData.length)}},dependencies:[m.ez,m.sg,m.O5,m.uU,c.u5,c._Y,c.Fj,c.JJ,c.JL,c.On,c.F,f.A0,f.w9,A.Y,u.aw,u.X$]})}return o})()}}]);