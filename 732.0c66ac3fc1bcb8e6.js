"use strict";(self.webpackChunkatm_mangment=self.webpackChunkatm_mangment||[]).push([[732],{5277:(Z,C,l)=>{l.d(C,{J:()=>I});var _=l(9862),e=l(5879);let I=(()=>{class c{constructor(){this.baseUrl="http://waleed81-001-site1.jtempurl.com",this.httpClient=(0,e.f3M)(_.eN)}createCompany(p){return this.httpClient.post(`${this.baseUrl}/Company/CreateCompany`,p)}updateData(p,s){return this.httpClient.put(`${this.baseUrl}/Company/UpdateCompany?CompanyId=${p}`,s)}getData(){return this.httpClient.get(`${this.baseUrl}/Company/GetAllCompanies`)}getAllRepresentativesForSpeceificCompany(p){return this.httpClient.get(`${this.baseUrl}/Company/GetAllRepresentativesForSpeceificCompany?CompanyDataId=${p}`)}getAllEmployeeForSpeceificCompany(p){return this.httpClient.get(`${this.baseUrl}/Company/GetAllEmployeeForSpeceificCompany?CompanyDataId=${p}`)}getAllAdmins(){return this.httpClient.get(`${this.baseUrl}/Company/GetAllAdmins`)}deleteData(p,s){return this.httpClient.delete(`${this.baseUrl}/Company/DeleteCompany?UserId=${p}&CompanyId=${s}`)}getCompaniesProgramSetting(){return this.httpClient.get(`${this.baseUrl}/Company/GetCompaniesProgramSetting`)}static#e=this.\u0275fac=function(s){return new(s||c)};static#t=this.\u0275prov=e.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})()},1732:(Z,C,l)=>{l.r(C),l.d(C,{ListOfWorkPlansComponent:()=>K});var _=l(6283),e=l(5879),m=l(6814),I=l(5861),c=l(6223),f=l(8431),p=l(7285),s=l(1849),h=l(882),b=l(3740),v=l(7361);class k{constructor(){this.workPlanFooters=[],this.bankDataId="",this.startDate=`${(new Date).getUTCFullYear()}-${(new Date).getUTCMonth()+1}-${(new Date).getDate()}`,this.endDate=`${(new Date).getUTCFullYear()}-${(new Date).getUTCMonth()+1}-${(new Date).getDate()}`,this.description="",this.cityCodeId=null,this.createUserId=null,this.governorateCodeId=null,this.startDateMdule={day:(new Date).getDate(),month:(new Date).getUTCMonth()+1,year:(new Date).getUTCFullYear()},this.endDateMdule={day:(new Date).getDate()+1,month:(new Date).getUTCMonth()+1,year:(new Date).getUTCFullYear()},this.repetedDatesIfExist=[]}}var A=l(6345),g=l(5277),P=l(7394),D=l(9315),M=l(1778),y=l(2425),w=l(3999);const L=["checkboxes"],T=function(){return{standalone:!0}};function F(o,u){if(1&o){const t=e.EpF();e.TgZ(0,"ng-select",35,36),e.NdJ("ngModelChange",function(a){e.CHM(t);const r=e.oxw();return e.KtG(r.formData.governorateCodeId=a)})("change",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.getCities(a.formData.governorateCodeId))})("clear",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.formData.cityCodeId=null)}),e.ALo(2,"translate"),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("clearable",!0)("name","governorate")("items",t.governoratiesList)("ngModel",t.formData.governorateCodeId)("notFoundText",e.lcZ(2,9,"workplans.noData"))("searchable",!0)("required",!0)("disabled",t.isView)("ngModelOptions",e.DdM(11,T))}}function W(o,u){if(1&o){const t=e.EpF();e.TgZ(0,"ng-select",37,38),e.NdJ("ngModelChange",function(a){e.CHM(t);const r=e.oxw();return e.KtG(r.formData.cityCodeId=a)})("change",function(){e.CHM(t);const a=e.oxw();return a.changeCity(),e.KtG(a.atmNewList=[])}),e.ALo(2,"translate"),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("ngModelOptions",e.DdM(11,T))("clearable",!1)("name","cityName")("items",t.listOfCiteis)("ngModel",t.formData.cityCodeId)("required",!0)("searchable",!0)("notFoundText",e.lcZ(2,9,"workplans.noData"))("disabled",t.isView||!t.formData.governorateCodeId)}}function O(o,u){if(1&o){const t=e.EpF();e.TgZ(0,"ng-select",39,40),e.NdJ("ngModelChange",function(a){e.CHM(t);const r=e.oxw();return e.KtG(r.representativeId=a)})("change",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.changeRepresentive())}),e.ALo(2,"translate"),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("disabled",!t.formData.governorateCodeId||!t.formData.cityCodeId)("ngModelOptions",e.DdM(11,T))("clearable",!1)("name","representative")("items",t.representativesList)("ngModel",t.representativeId)("required",!0)("searchable",!0)("notFoundText",e.lcZ(2,9,"workplans.noData"))}}function S(o,u){if(1&o){const t=e.EpF();e.TgZ(0,"ng-select",41,42),e.NdJ("ngModelChange",function(a){e.CHM(t);const r=e.oxw();return e.KtG(r.selectedListOfDates=a)})("change",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.changeDates())}),e.ALo(2,"translate"),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("ngModelOptions",e.DdM(10,T))("multiple",!0)("clearable",!1)("name","dates")("items",t.datesList)("ngModel",t.selectedListOfDates)("searchable",!1)("notFoundText",e.lcZ(2,8,"workplans.noData"))}}function H(o,u){1&o&&(e.TgZ(0,"p",43),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"workplans.required")," "))}function q(o,u){if(1&o){const t=e.EpF();e.TgZ(0,"tr")(1,"td",31),e._uU(2),e.qZA(),e.TgZ(3,"td",31),e._uU(4),e.qZA(),e.TgZ(5,"td",31),e._uU(6),e.qZA(),e.TgZ(7,"td",45)(8,"div")(9,"input",46,47),e.NdJ("change",function(a){const i=e.CHM(t).$implicit,d=e.oxw(2);return e.KtG(d.updateSelectedAtm(i,a))})("ngModelChange",function(a){const i=e.CHM(t).$implicit;return e.KtG(i.isChecked=a)}),e.qZA()()()()}if(2&o){const t=u.$implicit,n=u.index,a=e.oxw(2);e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(t.atmcode),e.xp6(2),e.Oqu(t.atmserial),e.xp6(3),e.Q6J("disabled",a.isView)("name","checkboxName"+n)("id","checkbox"+n)("ngModel",t.isChecked)}}function N(o,u){if(1&o&&(e.ynx(0),e.YNc(1,q,11,7,"tr",44),e.BQk()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.atmNewList)("ngForTrackBy",t.identify)}}function $(o,u){1&o&&(e.TgZ(0,"tr")(1,"td",48),e._uU(2," \u0644\u0627\u064a\u0648\u062c\u062f \u0628\u064a\u0627\u0646\u0627\u062a \u0644\u0639\u0631\u0636\u0647\u0627 \u0628\u062f\u0627\u062e\u0644 \u0627\u0644\u062c\u062f\u0648\u0644 "),e.qZA()()),2&o&&(e.xp6(1),e.Q6J("colSpan",4))}const J=function(o){return{"ng-error":o}};let x=(()=>{class o{constructor(){this.title="Add new work plan",this.id="",this.bankId="",this.isView=!1,this.workPlaneHeaderData=null,this.roles=[],this.representativeId=null,this.formData=new k,this.listOfBanks=[],this.activeModal=(0,e.f3M)(p.Kz),this.workPlanService=(0,e.f3M)(s.B),this.lookupService=(0,e.f3M)(v.W),this.userService=(0,e.f3M)(h.K),this.toastrService=(0,e.f3M)(y._W),this.userData=null,this.listOfCiteis=[],this.workPlaneFooterList=[],this.atmService=(0,e.f3M)(A.s),this.companyService=(0,e.f3M)(g.J),this.representativesList=[],this.atmNewList=[],this.governoratiesList=[],this.bankService=(0,e.f3M)(M.y),this.selectedAtm=[],this.subscriptions=new P.w0,this.footerId="",this.atmList=[],this.datesList=[],this.selectAll=!1,this.selectedListOfDates=[],this.userService.getUserData().subscribe(t=>{this.userData=t})}ngOnChanges(t){console.log("ch",t)}ngOnDestroy(){this.subscriptions.unsubscribe()}getGovernoraties(){this.subscriptions.add(this.userService.getGovernoraties().subscribe(t=>{t&&(this.governoratiesList=t),this.workPlaneHeaderData&&this.getCities(this.workPlaneHeaderData.governorateCodeId)}))}identify(t,n){return n.dataAtmid}ngOnInit(){this.getRepresentatives(),this.getGovernoraties(),this.workPlaneHeaderData&&this.bankId&&(this.formData.bankDataId=this.workPlaneHeaderData.bankDataId,this.formData.description=this.workPlaneHeaderData.description,this.formData.modifiedby=this.userData?this.userData.UserId:0,this.formData.endDate=this.workPlaneHeaderData.endDate,this.formData.startDate=this.workPlaneHeaderData.startDate,this.formData.governorateCodeId=this.workPlaneHeaderData.governorateCodeId,this.formData.cityCodeId=this.workPlaneHeaderData.cityCodeId,this.getCities(this.workPlaneHeaderData.governorateCodeId),this.formData.endDateMdule={day:parseInt(this.formData.endDate.slice(8,10)),month:parseInt(this.formData.endDate.slice(5,7)),year:parseInt(this.formData.endDate.slice(0,4))},this.formData.startDateMdule={day:parseInt(this.formData.startDate.slice(8,10)),month:parseInt(this.formData.startDate.slice(5,7)),year:parseInt(this.formData.startDate.slice(0,4))},this.formData.workPlanFooters=[],this.getWorkPlaneFooter(this.workPlaneHeaderData.workPlanId)),this.datesList=this.daysInMonth(this.formData.startDate)}daysInMonth(t){const n=new Date(t),a=new Date(n.getFullYear(),n.getMonth(),2),r=new Date(n.getFullYear(),n.getMonth()+1,1),i=[];let d=a;for(;d<=r;)i.push(d.toISOString()),d=new Date(d.setDate(d.getDate()+1));let U=[];return i.forEach(R=>{U.push(R.slice(0,10))}),U}getWorkPlaneFooter(t){this.subscriptions.add(this.getFooterData(t).subscribe(n=>{this.getWorkPlaneFooterData(n[1],n[0],n[2])}))}getWorkPlaneHeaderList(){this.bankId&&this.workPlanService.getWorkPlaneHeader(this.bankId).subscribe(t=>{t&&(this.workPlanHeader=t)})}changeStartDate(t){this.formData.startDate=t,this.datesList=this.daysInMonth(this.formData.startDate)}updateSelectedAtmSelectAll(){this.atmNewList.forEach(this.selectAll?t=>{t.representativeId=this.representativeId,t.isChecked=!0}:t=>{t.representativeId=null,t.isChecked=!1})}getFooterData(t){const n=this.atmService.getData(this.bankId,this.formData.cityCodeId,this.formData.governorateCodeId),a=this.workPlanService.getAllWorkPlaneFooter(t),r=this.companyService.getAllRepresentativesForSpeceificCompany(this.userData?this.userData?.CompanyId:"");return(0,D.D)([n,a,r])}getWorkPlaneFooterData(t,n,a){var r=this;return(0,I.Z)(function*(){r.workPlanService.reverseWorkPlaneFooterList(t,r.workPlaneHeaderData?.bankDataId,n).then(i=>{i&&(r.atmList=i,r.representativesList=a,r.representativeId=r.atmList.filter(d=>d.isChecked)[0].representativeId,r.footerId=t[0].footerId,r.atmNewList=r.atmList.filter(d=>d.representativeId===r.representativeId||!d.representativeId))})})()}saveData(){this.id.length>0?this.updateData():this.addNewData()}changeDates(){}addNewData(){if(this.formData.bankDataId=this.bankId,this.formData.repetedDatesIfExist=[],this.selectedListOfDates.forEach(t=>{this.formData.repetedDatesIfExist.push(t+"T00:00:01.118Z")}),this.formData.startDate=this.getDateForServerFormat(this.formData.startDate),this.formData.endDate=this.getDateForServerFormat(this.formData.endDate),this.userData&&(this.formData.createUserId=this.userData?.UserId),this.formData.workPlanFooters=this.workPlanService.mapWorkPlaneFooterList(this.userData?.UserId,this.atmList),0==this.formData.workPlanFooters.length||!this.formData.workPlanFooters)return this.toastrService.error("Must select at least one representive"),null;this.subscriptions.add(this.workPlanService.createWorkPlaneHeader(this.formData).subscribe(t=>{t&&this.activeModal.close(!0)}))}formatTwoDigit(t){return t<10?"0"+t:t.toString()}getDateForServerFormat(t){var n=t.split("-");return n[0]+"-"+this.formatTwoDigit(parseInt(n[1]))+"-"+this.formatTwoDigit(parseInt(n[2]))+"T00:00:00.000Z"}updateData(){if(this.formData.bankDataId=this.bankId,this.formData.repetedDatesIfExist=[],this.selectedListOfDates.forEach(t=>{this.formData.repetedDatesIfExist.push(t+"T00:00:01.118Z")}),this.formData.startDate=this.getDateForServerFormat(this.formData.startDate),this.formData.endDate=this.getDateForServerFormat(this.formData.endDate),this.userData&&(this.formData.createUserId=this.userData?.UserId),this.formData.workPlanFooters=this.workPlanService.mapWorkPlaneFooterList(this.userData?.UserId,this.atmList,this.footerId),console.log(this.formData),0==this.formData.workPlanFooters.length||!this.formData.workPlanFooters)return this.toastrService.error("Must select at least one representive"),null;this.subscriptions.add(this.workPlanService.updateWorkPlaneHeaderAndFooter(this.id,this.formData).subscribe(t=>{t&&this.activeModal.close(!0)}))}changeCity(){this.selectAll=!1,this.updateSelectedAtmSelectAll(),this.subscriptions.add(this.getRepresentativesAndAtm().subscribe(t=>{t&&(this.atmNewList=t[0].map(n=>({...n,representativeId:null,isChecked:!1})),this.atmList=t[0].map(n=>({...n,representativeId:null,isChecked:!1})))}))}changeCity1(){this.selectAll=!1,this.updateSelectedAtmSelectAll(),this.subscriptions.add(this.getRepresentativesAndAtm().subscribe(t=>{t&&(console.log("lkjhg",this.representativesList),this.getWorkPlaneHeaderList(),this.subscriptions.add(this.workPlanService.getWorkPlaneHeader(this.bankId).subscribe(n=>{if(n){this.workPlanHeader=n,console.log(this.workPlanHeader,"get all ATM in city",t);const a=this.workPlanHeader.filter(r=>t.some(i=>r.workPlanId===i.dataId));console.log("Matching Header Item:",a),this.atmNewList=t[0].map(r=>({...r,representativeId:null,isChecked:!1})),this.atmList=t[0].map(r=>({...r,representativeId:null,isChecked:!1}))}})))}))}changeRepresentive(){this.atmNewList=this.atmList.filter(t=>t.representativeId===this.representativeId||!t.representativeId)}getRepresentatives(){this.subscriptions.add(this.companyService.getAllRepresentativesForSpeceificCompany(this.userData?this.userData?.CompanyId:"").subscribe(t=>{t&&(this.representativesList=t),this.workPlaneHeaderData&&(this.representativeId=this.workPlaneFooterList[0]?.representivUserId)})),console.log("op",this.representativesList)}getRepresentativesAndAtm(){const t=this.getDateForServerFormat(this.formData.startDate);console.log(t);const n=this.atmService.getData(this.bankId,this.formData.cityCodeId,this.formData.governorateCodeId,t);return(0,D.D)([n])}getCities(t){t&&this.subscriptions.add(this.bankService.getCitiesByGovernorateId(t).subscribe(n=>{n&&(this.listOfCiteis=n,setTimeout(()=>{this.workPlaneHeaderData&&(this.formData.cityCodeId=this.workPlaneHeaderData.cityCodeId)},1e3))}))}updateSelectedAtm(t,n){t.representativeId=t.isChecked?this.representativeId:null}static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-add-update-work-plan"]],viewQuery:function(n,a){if(1&n&&e.Gf(L,5),2&n){let r;e.iGM(r=e.CRH())&&(a.checkboxes=r)}},inputs:{title:"title",id:"id",bankId:"bankId",isView:"isView",workPlaneHeaderData:"workPlaneHeaderData"},standalone:!0,features:[e.TTD,e.jDz],decls:73,vars:59,consts:[[1,"row","m-0","p-3"],[1,"col-9"],[1,"col-3","text-end","pt-2"],[1,"fa-solid","fa-xmark","text-danger","fs-4","pointer",3,"click"],[1,"p-3",3,"ngSubmit"],["atmForm","ngForm"],[1,"row"],[1,"col-12","col-md-4"],[3,"label","currentForm","ngbDateStruct","disabled","CurentDate"],[3,"label","ngbDateStruct","currentForm","disabled","CurentDate"],["for","governorate",1,"my-1","required"],["ngDefaultControl","","bindLabel","governorateNameL1","bindValue","governorateId",3,"clearable","name","items","ngModel","notFoundText","searchable","required","disabled","ngModelOptions","ngModelChange","change","clear",4,"ngIf"],["for","city",1,"required","my-1"],["ngDefaultControl","","bindLabel","cityNameL1","bindValue","cityId",3,"ngModelOptions","clearable","name","items","ngModel","required","searchable","notFoundText","disabled","ngModelChange","change",4,"ngIf"],["for","representative",1,"required","my-1"],["ngDefaultControl","","bindLabel","userName","bindValue","id",3,"disabled","ngModelOptions","clearable","name","items","ngModel","required","searchable","notFoundText","ngModelChange","change",4,"ngIf"],["for","dates",1,"required","my-1"],["ngDefaultControl","",3,"ngModelOptions","multiple","clearable","name","items","ngModel","searchable","notFoundText","ngModelChange","change",4,"ngIf"],[1,"col-12","py-3"],["for","description",1,"required"],["ngDefaultControl","",1,"form-control",3,"disabled","name","required","ngModel","ngClass","ngModelChange"],["description","ngModel"],["class","text-danger",4,"ngIf"],[1,"col-12","text-end"],["for","selectAllInput",1,"mx-2"],["type","checkbox",1,"form-check-input",3,"disabled","name","id","ngModel","change","ngModelChange"],["selectAllInput",""],[1,"col-12","overflow-y-auto","height-200"],[1,"table","table-responsive","table-striped"],[1,"bg-light","sticky-top","top-0","table-dark"],[1,"bg-dark"],[1,"text-center"],[4,"ngIf","ngIfElse"],["type","submit",1,"btn","btn-dark","btn-md","shadow-lg","mt-3","col-3",3,"disabled"],["noData",""],["ngDefaultControl","","bindLabel","governorateNameL1","bindValue","governorateId",3,"clearable","name","items","ngModel","notFoundText","searchable","required","disabled","ngModelOptions","ngModelChange","change","clear"],["governorate","ngModel"],["ngDefaultControl","","bindLabel","cityNameL1","bindValue","cityId",3,"ngModelOptions","clearable","name","items","ngModel","required","searchable","notFoundText","disabled","ngModelChange","change"],["city","ngModel"],["ngDefaultControl","","bindLabel","userName","bindValue","id",3,"disabled","ngModelOptions","clearable","name","items","ngModel","required","searchable","notFoundText","ngModelChange","change"],["representative","ngModel"],["ngDefaultControl","",3,"ngModelOptions","multiple","clearable","name","items","ngModel","searchable","notFoundText","ngModelChange","change"],["dates","ngModel"],[1,"text-danger"],[4,"ngFor","ngForOf","ngForTrackBy"],["container","body",1,"text-end"],["checked","getWorkPlanesReport","type","checkbox",1,"form-check-input",3,"disabled","name","id","ngModel","change","ngModelChange"],["checkboxes",""],[3,"colSpan"]],template:function(n,a){if(1&n){const r=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"h3"),e._uU(3),e.qZA()(),e.TgZ(4,"div",2)(5,"i",3),e.NdJ("click",function(){return a.activeModal.close(null)}),e.qZA()()(),e.TgZ(6,"form",4,5),e.NdJ("ngSubmit",function(){e.CHM(r);const d=e.MAs(7);return e.KtG(d.valid&&a.saveData())}),e.TgZ(8,"div",6)(9,"div",7)(10,"app-date-input",8),e.NdJ("CurentDate",function(d){return a.changeStartDate(d)}),e.ALo(11,"translate"),e.qZA()(),e.TgZ(12,"div",7)(13,"app-date-input",9),e.NdJ("CurentDate",function(d){return a.formData.endDate=d}),e.ALo(14,"translate"),e.qZA()(),e.TgZ(15,"div",7)(16,"div")(17,"label",10),e._uU(18),e.ALo(19,"translate"),e.qZA(),e.YNc(20,F,3,12,"ng-select",11),e.qZA()(),e.TgZ(21,"div",7)(22,"div")(23,"label",12),e._uU(24),e.ALo(25,"translate"),e.qZA(),e.YNc(26,W,3,12,"ng-select",13),e.qZA()(),e.TgZ(27,"div",7)(28,"div")(29,"label",14),e._uU(30),e.ALo(31,"translate"),e.qZA(),e.YNc(32,O,3,12,"ng-select",15),e.qZA()(),e.TgZ(33,"div",7)(34,"div")(35,"label",16),e._uU(36),e.ALo(37,"translate"),e.qZA(),e.YNc(38,S,3,11,"ng-select",17),e.qZA()(),e.TgZ(39,"div",18)(40,"label",19),e._uU(41),e.ALo(42,"translate"),e.qZA(),e.TgZ(43,"textarea",20,21),e.NdJ("ngModelChange",function(d){return a.formData.description=d}),e.qZA(),e.YNc(45,H,3,3,"p",22),e.qZA(),e.TgZ(46,"div",23)(47,"label",24),e._uU(48),e.ALo(49,"translate"),e.qZA(),e.TgZ(50,"input",25,26),e.NdJ("change",function(){return a.updateSelectedAtmSelectAll()})("ngModelChange",function(d){return a.selectAll=d}),e.qZA()(),e.TgZ(52,"div",27)(53,"table",28)(54,"thead",29)(55,"tr",30)(56,"th",31),e._uU(57,"#"),e.qZA(),e.TgZ(58,"th",31),e._uU(59),e.ALo(60,"translate"),e.qZA(),e.TgZ(61,"th",31),e._uU(62),e.ALo(63,"translate"),e.qZA(),e._UZ(64,"th",31),e.qZA()(),e.TgZ(65,"tbody"),e.YNc(66,N,2,2,"ng-container",32),e.qZA()()(),e.TgZ(67,"div",23)(68,"button",33),e._uU(69),e.ALo(70,"translate"),e.qZA()()()(),e.YNc(71,$,3,1,"ng-template",null,34,e.W1O)}if(2&n){const r=e.MAs(7),i=e.MAs(44),d=e.MAs(72);e.xp6(3),e.Oqu(a.title),e.xp6(7),e.Q6J("label",e.lcZ(11,35,"workplans.startDate"))("currentForm",r)("ngbDateStruct",a.formData.startDateMdule)("disabled",a.isView),e.xp6(3),e.Q6J("label",e.lcZ(14,37,"workplans.endDate"))("ngbDateStruct",a.formData.endDateMdule)("currentForm",r)("disabled",a.isView),e.xp6(5),e.Oqu(e.lcZ(19,39,"workplans.governorate")),e.xp6(2),e.Q6J("ngIf",a.governoratiesList),e.xp6(4),e.Oqu(e.lcZ(25,41,"workplans.city")),e.xp6(2),e.Q6J("ngIf",a.listOfCiteis),e.xp6(4),e.Oqu(e.lcZ(31,43,"workplans.representative")),e.xp6(2),e.Q6J("ngIf",a.representativesList),e.xp6(4),e.Oqu(e.lcZ(37,45,"workplans.rebatedDates")),e.xp6(2),e.Q6J("ngIf",a.datesList),e.xp6(3),e.Oqu(e.lcZ(42,47,"workplans.description")),e.xp6(2),e.Q6J("disabled",a.isView)("name","description")("required",!0)("ngModel",a.formData.description)("ngClass",e.VKq(57,J,(null==i.errors?null:i.errors.required)&&(r.submitted||i.touched))),e.xp6(2),e.Q6J("ngIf",(null==i.errors?null:i.errors.required)&&(r.submitted||i.touched)),e.xp6(3),e.Oqu(e.lcZ(49,49,"workplans.selectAll")),e.xp6(2),e.Q6J("disabled",a.isView)("name","selectAll")("id","selectAllInput")("ngModel",a.selectAll),e.xp6(9),e.Oqu(e.lcZ(60,51,"workplans.code")),e.xp6(3),e.Oqu(e.lcZ(63,53,"workplans.name")),e.xp6(4),e.Q6J("ngIf",a.formData.governorateCodeId&&a.formData.cityCodeId&&a.atmNewList&&a.atmNewList.length>0)("ngIfElse",d),e.xp6(2),e.Q6J("disabled",a.isView),e.xp6(1),e.hij(" ",e.lcZ(70,55,"workplans.save")," ")}},dependencies:[m.ez,m.mk,m.sg,m.O5,c.u5,c._Y,c.Fj,c.Wl,c.JJ,c.JL,c.Q7,c.On,c.F,f.A0,f.w9,b.Y,w.aw,w.X$],styles:[".height-200{height:300px!important}\n"],encapsulation:2})}return o})();var E=l(3103);function G(o,u){if(1&o){const t=e.EpF();e.TgZ(0,"ng-select",15,16),e.NdJ("clear",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.dataTable=[])})("ngModelChange",function(a){e.CHM(t);const r=e.oxw();return e.KtG(r.selectedBankId=a)})("clear",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.dataTable=[])})("change",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.getWorkPlaneHeaderList())}),e.ALo(2,"translate"),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("clearable",!0)("name","city")("items",t.listOfBanks)("ngModel",t.selectedBankId)("required",!0)("searchable",!0)("notFoundText",e.lcZ(2,7,"workplans.noDataFound"))}}function B(o,u){if(1&o&&(e.TgZ(0,"th",17),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&o){const t=u.$implicit;e.xp6(1),e.Oqu(e.lcZ(2,1,t))}}function Q(o,u){if(1&o){const t=e.EpF();e.TgZ(0,"tr")(1,"td",17),e._uU(2),e.qZA(),e.TgZ(3,"td",17),e._uU(4),e.ALo(5,"date"),e.qZA(),e.TgZ(6,"td",17),e._uU(7),e.ALo(8,"date"),e.qZA(),e.TgZ(9,"td",17),e._uU(10),e.qZA(),e.TgZ(11,"td",18)(12,"div",19)(13,"div",20),e._UZ(14,"i",21),e.TgZ(15,"div",22)(16,"button",23),e.NdJ("click",function(){const r=e.CHM(t).$implicit,i=e.oxw();return e.KtG(i.viewDataTable(r))}),e._UZ(17,"i",24),e._uU(18),e.ALo(19,"translate"),e.qZA(),e.TgZ(20,"button",23),e.NdJ("click",function(){const r=e.CHM(t).$implicit,i=e.oxw();return e.KtG(i.updateDataTable(r))}),e._UZ(21,"i",25),e._uU(22),e.ALo(23,"translate"),e.qZA(),e.TgZ(24,"button",23),e.NdJ("click",function(){const r=e.CHM(t).$implicit,i=e.oxw();return e.KtG(i.openCofirmDelete(r.workPlanId))}),e._UZ(25,"i",26),e._uU(26),e.ALo(27,"translate"),e.qZA()()()()()()}if(2&o){const t=u.$implicit,n=u.index;e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(e.xi3(5,7,t.startDate,"yyyy/MM/dd")),e.xp6(3),e.Oqu(e.xi3(8,10,t.endDate,"yyyy/MM/dd")),e.xp6(3),e.Oqu(t.description),e.xp6(8),e.hij(" ",e.lcZ(19,13,"workplans.view")," "),e.xp6(4),e.hij(" ",e.lcZ(23,15,"workplans.update")," "),e.xp6(4),e.hij(" ",e.lcZ(27,17,"workplans.delete")," ")}}let K=(()=>{class o{constructor(){this.direction="",this.cols=["#","workplans.startDate","workplans.endDate","workplans.description",""],this.dataTable=[],this.modalService=(0,e.f3M)(p.FF),this.translate=(0,e.f3M)(w.sK),this.userService=(0,e.f3M)(h.K),this.bankService=(0,e.f3M)(M.y),this.workPlanService=(0,e.f3M)(s.B),this.userData=null,this.listOfBanks=[],this.selectedBankId=null,this.userService.getUserData().subscribe(t=>{this.userData=t})}ngOnInit(){this.getBanks()}getBanks(){this.bankService.getData().subscribe(t=>{t&&(this.listOfBanks=t)})}getWorkPlaneHeaderList(){this.selectedBankId&&this.workPlanService.getWorkPlaneHeader(this.selectedBankId).subscribe(t=>{t&&(this.dataTable=t)})}addNew(){const t=this.modalService.open(x,{backdrop:"static",centered:!0,size:"lg"});t.componentInstance.title=this.translate.instant("workplans.addNew"),t.componentInstance.bankId=this.selectedBankId,t.result.then(n=>{n&&this.getWorkPlaneHeaderList()})}onScrollDown(t){this.appendItemsToDataTable(),this.direction="scroll down"}viewDataTable(t){const n=this.modalService.open(x,{backdrop:"static",centered:!0,size:"lg"});n.componentInstance.title=this.translate.instant("workplans.viewTitle"),n.componentInstance.workPlaneHeaderData=t,n.componentInstance.id=t.workPlanId,n.componentInstance.bankId=this.selectedBankId,n.componentInstance.isView=!0}updateDataTable(t){const n=this.modalService.open(x,{backdrop:"static",centered:!0,size:"lg"});n.componentInstance.title=this.translate.instant("workplans.updateTitle"),n.componentInstance.workPlaneHeaderData=t,n.componentInstance.bankId=this.selectedBankId,n.componentInstance.id=t.workPlanId,n.result.then(a=>{a&&this.getWorkPlaneHeaderList()})}openCofirmDelete(t){this.modalService.open(E.n,{backdrop:"static",centered:!0}).result.then(a=>{a&&this.deleteData(t)})}deleteData(t){this.workPlanService.deleteWorkPlaneHeader(this.userData?this.userData?.UserId:0,t).subscribe(n=>{this.getWorkPlaneHeaderList()})}appendItemsToDataTable(){}static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-list-of-work-plans"]],standalone:!0,features:[e.jDz],decls:25,vars:17,consts:[[1,"row","m-0","pb-3"],[1,"col-9"],[1,"p-2"],[1,"col-3","text-end"],[1,"btn","btn-dark","mt-3",3,"disabled","click"],[1,"col-6"],["for","city",1,"required","my-1"],["ngDefaultControl","","bindLabel","banknameL1","bindValue","bankId",3,"clearable","name","items","ngModel","required","searchable","notFoundText","clear","ngModelChange","change",4,"ngIf"],[1,"text-muted"],["infinite-scroll","",1,"search-results-container",3,"scrollWindow","scrolled"],[1,"table","table-responsive","table-striped"],[1,"bg-light","sticky-top","top-0","table-dark"],[1,"bg-dark"],["class","text-center",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["ngDefaultControl","","bindLabel","banknameL1","bindValue","bankId",3,"clearable","name","items","ngModel","required","searchable","notFoundText","clear","ngModelChange","change"],["city","ngModel"],[1,"text-center"],["container","body",1,"text-end"],["container","body",1,"btn-group","me-3"],["ngbDropdown","","role","group","aria-label","Button group with nested dropdown",1,"btn-group"],["ngbDropdownToggle","",1,"fa-solid","fa-list","pointer"],["ngbDropdownMenu","",1,"dropdown-menu"],["ngbDropdownItem","",3,"click"],[1,"fa-solid","fa-eye"],[1,"fa-regular","fa-pen-to-square","text-primary"],[1,"fa-solid","fa-trash","text-danger"]],template:function(n,a){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h2",2),e._uU(3),e.ALo(4,"translate"),e.qZA()(),e.TgZ(5,"div",3)(6,"button",4),e.NdJ("click",function(){return a.addNew()}),e._uU(7),e.ALo(8,"translate"),e.qZA()()(),e.TgZ(9,"div",5)(10,"div")(11,"label",6),e._uU(12),e.ALo(13,"translate"),e.qZA(),e.YNc(14,G,3,9,"ng-select",7),e.TgZ(15,"p",8),e._uU(16),e.ALo(17,"translate"),e.qZA()()(),e.TgZ(18,"div",9),e.NdJ("scrolled",function(i){return a.onScrollDown(i)}),e.TgZ(19,"table",10)(20,"thead",11)(21,"tr",12),e.YNc(22,B,3,3,"th",13),e.qZA()(),e.TgZ(23,"tbody"),e.YNc(24,Q,28,19,"tr",14),e.qZA()()()),2&n&&(e.xp6(3),e.Oqu(e.lcZ(4,9,"workplans.title")),e.xp6(3),e.Q6J("disabled",!a.selectedBankId),e.xp6(1),e.Oqu(e.lcZ(8,11,"workplans.addNew")),e.xp6(5),e.Oqu(e.lcZ(13,13,"workplans.selectBank")),e.xp6(2),e.Q6J("ngIf",a.listOfBanks),e.xp6(2),e.Oqu(e.lcZ(17,15,"workplans.selectBankInfo")),e.xp6(2),e.Q6J("scrollWindow",!1),e.xp6(4),e.Q6J("ngForOf",a.cols),e.xp6(2),e.Q6J("ngForOf",a.dataTable))},dependencies:[m.ez,m.sg,m.O5,m.uU,_.Rq,_.Ry,p.XC,p.jt,p.iD,p.Vi,p.TH,c.u5,c.Fj,c.JJ,c.Q7,c.On,f.A0,f.w9,w.aw,w.X$]})}return o})()},1849:(Z,C,l)=>{l.d(C,{B:()=>c});var _=l(5861),e=l(5879),m=l(9862),I=l(553);let c=(()=>{class f{constructor(){this.baseUrl=I.N.apiURL,this.httpClient=(0,e.f3M)(m.eN)}createWorkPlaneHeader(s){return this.httpClient.post(`${this.baseUrl}/WorkPlaneHeader/CreateWorkPlaneHeader`,s)}updateWorkPlaneHeaderAndFooter(s,h){return this.httpClient.put(`${this.baseUrl}/WorkPlaneHeader/UpdateWorkPlaneHeaderAndFooter?WorkPlanHeaderId=${s}`,h)}getWorkPlanesReport(s){return this.httpClient.get(`${this.baseUrl}/DataAtm/WorkPlanFiltered?&dateFrom=${s.dateFrom}&dateTo=${s.dateTo}${s.representativeId?"&representativeId="+s.representativeId:""}${s.orderStatusId?"&orderStatusId="+s.orderStatusId:""} ${s.governorateCodeId?"&governorateCodeId="+s.governorateCodeId:""}${s.bankDataId?"&BankDataId="+s.bankDataId:""}${s.cityCodeId?"&cityCodeId="+s.cityCodeId:""}`)}deleteWorkPlaneHeader(s,h){return this.httpClient.delete(`${this.baseUrl}/WorkPlaneHeader/DeleteWorkPlaneHeader?UserId=${s}&WorkPlanId=${h}`)}getWorkPlaneHeader(s){return this.httpClient.get(`${this.baseUrl}/WorkPlaneHeader/GetAllWorkPlaneHeader?BankDataId=${s}`)}getAllWorkPlaneDetails(s,h){return this.httpClient.get(`${this.baseUrl}/WorkPlanDetail/GetAllWorkPlanDetail?WorkPlanFooterId=${h}&WorkPlanHeaderId=${s}`)}getAllWorkPlaneFooter(s){return this.httpClient.get(`${this.baseUrl}/WorkPlanFooter/GetAllWorkPlaneFooter?WorkPlanHeaderId=${s}`)}deleteWorkPlaneFooter(s,h){return this.httpClient.delete(`${this.baseUrl}/WorkPlanFooter/DeleteWorkPlaneFooter?UserId=${s}&WorkPlanFooterId=${h}`)}createWorkPlaneFooter(s){return this.httpClient.post(`${this.baseUrl}/WorkPlanFooter/CreateWorkPlaneFooter`,s)}getAllOrderStatus(){return this.httpClient.get(`${this.baseUrl}/WorkPlanFooter/GetAllOrderStatus`)}mapWorkPlaneFooterList(s,h,b=""){return h.filter(k=>k.isChecked).map(k=>({footerId:b,dataAtmid:k.dataId,representivUserId:k.representativeId,orderStatusId:1,commentVisit:"",damagesComment:"",createUserId:parseInt(s)}))}reverseWorkPlaneFooterList(s,h,b){return(0,_.Z)(function*(){let v=[];return yield s.find(A=>A.dataAtmid),yield b.forEach(function(){var A=(0,_.Z)(function*(g,P){let D=yield s.find(y=>y.dataAtmid===b[P].dataId),M=yield{representativeId:D&&D.representivUserId?D.representivUserId:null,dataId:g.dataId,createUserId:g.createUserId,bankDataId:h,bankContractId:null,isChecked:!(!D||!D.representivUserId),address:"",governorateCodeId:null,atmaLocation:null,atmcode:g.atmcode,atmserial:g.atmserial,atmmodel:g.atmmodel,cityCodeId:g.cityCodeId,atmaddress:g.atmaddress,atmlong:g.atmlong,atmlat:g.atmlong,atmDate:g.atmDate,atmDateMdule:g.atmDateMdule};yield v.push(M)});return function(g,P){return A.apply(this,arguments)}}()),yield v})()}static#e=this.\u0275fac=function(h){return new(h||f)};static#t=this.\u0275prov=e.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"})}return f})()}}]);