"use strict";(self.webpackChunkatm_mangment=self.webpackChunkatm_mangment||[]).push([[942],{8942:(Q,x,n)=>{n.r(x),n.d(x,{WorkPlansReportComponent:()=>$});var t=n(5879),m=n(6814);class C{constructor(){this.dateFrom="",this.dateTo="",this.orderStatusId=null,this.governorateCodeId=null,this.bankDataId=null,this.cityCodeId=null,this.representativeId=null,this.startDateMdule={day:(new Date).getDate(),month:(new Date).getUTCMonth()+1,year:(new Date).getUTCFullYear()},this.endDateMdule={day:(new Date).getDate(),month:(new Date).getUTCMonth()+1,year:(new Date).getUTCFullYear()}}}var u=n(6223),T=n(8431),b=n(1849),k=n(5277),D=n(882),v=n(9862),A=n(217),y=n(553),g=n(1486);let R=(()=>{class s{constructor(){this.baseUrl=y.N.apiURL,this.httpClient=(0,t.f3M)(v.eN)}exportJsonAsExcelFile(e,o){const r={Sheets:{data:g.P6.json_to_sheet(e)},SheetNames:["data"]},l=g.cW(r,{bookType:"xlsx",type:"array"});this.saveAsExcelFile(l,o)}exportTableAsExcelFile(e,o){const r={Sheets:{data:g.P6.table_to_sheet(e)},SheetNames:["data"]},l=g.cW(r,{bookType:"xlsx",type:"array"});this.saveAsExcelFile(l,o)}saveAsExcelFile(e,o){const a=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});A.saveAs(a,o+(new Date).getTime()+".xlsx")}getWorkPlanesReport(e){return this.httpClient.get(`${this.baseUrl}/DataAtm/WorkPlanYesterdayOrderNew?`)}deleteImage(e,o){return this.httpClient.delete(`${this.baseUrl}/WorkPlanDetail/DeleteWorkPlanDetail?UserId=${e}`,{body:[o]})}getComments(e){return this.httpClient.get(`${this.baseUrl}/Comment/GetAllComments?footerId=${e}`)}createComment(e){return this.httpClient.post(`${this.baseUrl}/Comment/CreateComment`,{comments:[e]})}updateComment(e,o){return this.httpClient.put(`${this.baseUrl}/Comment/UpdateComment?commentId=${o}`,e)}deleteComment(e){return this.httpClient.delete(`${this.baseUrl}/Comment/DeleteComment?commentId=${e}`,{body:[e]})}updateOrderStatus(e,o,a){return this.httpClient.put(`${this.baseUrl}/WorkPlanFooter/OrderStatusUpdateSet3456?UserId=${e}&WorkPlanFooterId=${o}&OrderStatusId=${a}`,{})}static#t=this.\u0275fac=function(o){return new(o||s)};static#e=this.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var Z=n(7285),U=n(527),E=n(9315),P=n(9846),f=(n(3403),n(3999)),F=n(4456),S=n.n(F);const W=["excelTable"];function O(s,h){if(1&s){const e=t.EpF();t.TgZ(0,"button",13),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.exportAsExcel())}),t._uU(1),t.ALo(2,"translate"),t._UZ(3,"i",14),t.qZA()}2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"reports.workplans.EXPORT_XLSX")," "))}function M(s,h){if(1&s){const e=t.EpF();t.TgZ(0,"button",15),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.exportToPDF())}),t._uU(1),t.ALo(2,"translate"),t._UZ(3,"i",16),t.qZA()}2&s&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"reports.workplans.EXPORT_PDF")," "))}function L(s,h){if(1&s&&(t.TgZ(0,"tr")(1,"td",10),t._uU(2),t.qZA(),t.TgZ(3,"td",10),t._uU(4),t.ALo(5,"date"),t.qZA(),t.TgZ(6,"td",10),t._uU(7),t.ALo(8,"date"),t.qZA(),t.TgZ(9,"td",10),t._uU(10),t.qZA(),t.TgZ(11,"td",10),t._uU(12),t.qZA(),t.TgZ(13,"td",10),t._uU(14),t.qZA()()),2&s){const e=h.$implicit,o=h.index;t.xp6(2),t.Oqu(o+1),t.xp6(2),t.Oqu(t.xi3(5,6,e.startDate,"yyyy/MM/dd")),t.xp6(3),t.Oqu(t.xi3(8,9,e.endDate,"yyyy/MM/dd")),t.xp6(3),t.Oqu(e.orderStatusName),t.xp6(2),t.Oqu(e.atmCode),t.xp6(2),t.Oqu(e.userName)}}function N(s,h){1&s&&(t.TgZ(0,"h3",10),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&s&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"reports.workplans.NO_DATA_FOUND")))}let $=(()=>{class s{constructor(){this.dataTable=[],this.filteredData=[],this.searchQuery="",this.workPlaneReport=new C,this.representativiesList=[],this.orderStatusList=[],this.workPlaneService=(0,t.f3M)(b.B),this.companyService=(0,t.f3M)(k.J),this.ReportssService=(0,t.f3M)(R),this.userService=(0,t.f3M)(D.K),this.ngbModal=(0,t.f3M)(Z.FF),this.translate=(0,t.f3M)(f.sK),this.userService.getUserData().subscribe(e=>{this.userData=e})}ngOnInit(){this.getOrderStatus(),this.getAllRepresentativesForSpeceificCompany(),this.getReport()}getReport(){this.dataTable=[],this.ReportssService.getWorkPlanesReport(this.workPlaneReport).subscribe(e=>{const o=e.map(a=>this.ReportssService.getComments(a.footerId));(0,E.D)(o).subscribe(a=>{this.dataTable=e.map((r,l)=>({...r,damagesComments:a[l]})),this.filteredData=this.dataTable})})}filterData(){this.searchQuery?(this.filteredData=this.dataTable.filter(e=>e.atmCode.toLowerCase().includes(this.searchQuery.toLowerCase())),console.log(this.filteredData)):this.filteredData=this.dataTable}changeFromDate(e){this.workPlaneReport.dateFrom=e,this.getReport()}changeToDate(e){this.workPlaneReport.dateTo=e,this.getReport()}exportAsExcel(){const c={worksheet:"Worksheet",table:this.excelTable.nativeElement.innerHTML},d=document.createElement("a");var p,i;d.download="file.xls",d.href="data:application/vnd.ms-excel;base64,"+(p=c,i='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head>\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e</head><body><table>{table}</table></body></html>'.replace(/{(\w+)}/g,function(j,J){return p[J]}),window.btoa(unescape(encodeURIComponent(i)))),d.click()}getOrderStatus(){this.workPlaneService.getAllOrderStatus().subscribe(e=>{e&&(this.orderStatusList=e)})}getAllRepresentativesForSpeceificCompany(){this.companyService.getAllRepresentativesForSpeceificCompany(this.userData?this.userData.CompanyId:"").subscribe(e=>{e&&(this.representativiesList=e)})}openImage(e){window.open(e,"_blank")}openImages(e){let o=this.ngbModal.open(U.I,{backdrop:"static"});o.componentInstance.headerId=e.workPlanHeaderIdId,o.componentInstance.footerId=e.footerId,o.result.then(a=>{a&&this.getReport()})}exportToPDF(){const e=document.getElementById("pdf-export");e?S()(e,{scale:2}).then(o=>{const l=208*o.height/o.width;let c=l;const d=o.toDataURL("image/png");let i=new P.default("p","mm","a4"),p=0;for(i.addImage(d,"PNG",0,p,208,l),c-=295;c>0;)p=c-l,i.addPage(),i.addImage(d,"PNG",0,p,208,l),c-=295;i.save("work plan.pdf")}).catch(o=>{console.error("PDF export failed: ",o)}):console.error("Element with ID 'pdf-export' not found.")}static#t=this.\u0275fac=function(o){return new(o||s)};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-work-plans-report"]],viewQuery:function(o,a){if(1&o&&t.Gf(W,5),2&o){let r;t.iGM(r=t.CRH())&&(a.excelTable=r.first)}},standalone:!0,features:[t.jDz],decls:33,vars:23,consts:[[1,"row"],[1,"col-md-6"],[1,"row","justify-content-center"],["type","text",1,"form-control","mb-3",3,"placeholder","ngModel","ngModelChange"],["class","btn btn-dark",3,"click",4,"ngIf"],["class","btn btn-dark ms-2",3,"click",4,"ngIf"],["id","pdf-export",1,"table","table-responsive","table-striped"],["excelTable",""],[1,"bg-light","sticky-top","top-0","table-dark"],[1,"bg-dark"],[1,"text-center"],[4,"ngFor","ngForOf"],["class","text-center",4,"ngIf"],[1,"btn","btn-dark",3,"click"],[1,"fa","fa-file-excel"],[1,"btn","btn-dark","ms-2",3,"click"],[1,"fa-solid","fa-file-pdf"]],template:function(o,a){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"input",3),t.NdJ("ngModelChange",function(l){return a.searchQuery=l})("ngModelChange",function(){return a.filterData()}),t.ALo(4,"translate"),t.qZA()()(),t.TgZ(5,"div",1),t.YNc(6,O,4,3,"button",4),t.YNc(7,M,4,3,"button",5),t.qZA()(),t.TgZ(8,"div",0)(9,"table",6,7)(11,"thead",8)(12,"tr",9)(13,"th",10),t._uU(14,"#"),t.qZA(),t.TgZ(15,"th",10),t._uU(16),t.ALo(17,"translate"),t.qZA(),t.TgZ(18,"th",10),t._uU(19),t.ALo(20,"translate"),t.qZA(),t.TgZ(21,"th",10),t._uU(22),t.ALo(23,"translate"),t.qZA(),t.TgZ(24,"th",10),t._uU(25),t.ALo(26,"translate"),t.qZA(),t.TgZ(27,"th",10),t._uU(28),t.ALo(29,"translate"),t.qZA()()(),t.TgZ(30,"tbody"),t.YNc(31,L,15,12,"tr",11),t.qZA()(),t.YNc(32,N,3,3,"h3",12),t.qZA()),2&o&&(t.xp6(3),t.s9C("placeholder",t.lcZ(4,11,"reports.workplans.SEARCH_PLACEHOLDER")),t.Q6J("ngModel",a.searchQuery),t.xp6(3),t.Q6J("ngIf",a.filteredData.length>0),t.xp6(1),t.Q6J("ngIf",a.filteredData.length>0),t.xp6(9),t.Oqu(t.lcZ(17,13,"reports.workplans.START_DATE")),t.xp6(3),t.Oqu(t.lcZ(20,15,"reports.workplans.END_DATE")),t.xp6(3),t.Oqu(t.lcZ(23,17,"reports.workplans.STATUS")),t.xp6(3),t.Oqu(t.lcZ(26,19,"reports.workplans.ATM_CODE")),t.xp6(3),t.Oqu(t.lcZ(29,21,"reports.workplans.REPRESENTATIVE")),t.xp6(3),t.Q6J("ngForOf",a.filteredData),t.xp6(1),t.Q6J("ngIf",0==a.filteredData.length))},dependencies:[m.ez,m.sg,m.O5,m.uU,u.u5,u.Fj,u.JJ,u.On,T.A0,f.aw,f.X$]})}return s})()}}]);